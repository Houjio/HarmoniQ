{% extends "template.html" %}

{% block extra_head %}
    <link rel="stylesheet" href="{{ url_for('static', path='app_style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <!-- Date picker -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
{% endblock %}

{% block content %}
<div id="main">
    <div id="gestion" class="bg-light card">
        <div class="table-responsive">
            <table class="table table-bordered table-sm text-center" id="gestion-table">
                <thead>
                    <tr>
                        <th>Scénario Actif</th>
                        <th>Groupe Infrastructure Actif</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="active-scenario-title" class="text-muted">
                            N/A
                        </td>
                        <td id="active-groupe-title" class="text-muted">
                            N/A
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button id="run" class="btn btn-primary" disabled onclick="lancer_simulation()">
            Lancer Simulation
        </button>
    </div>
    <div id="scenario" class="bg-light card">
        <div class="card-body">
            <div class="d-flex w-100 mb-2 align-items-center">
                <h5 style="white-space: nowrap;">Scénario actif:</h5>
                <span class="mx-3"></span>
                <select name="scenario-actif" id="scenario-actif" class="form-select flex-grow-1" onchange="changeScenario()">

                </select>
            </div>
            <div id="scenario-info" class="card p-2" style="display: none;">
                <div class="card-body">
                    <p class="description"></p>
                    <p>
                        Du
                        <span class="scenario-debut fw-bold"></span>
                        au
                        <span class="scenario-fin fw-bold"></span>
                        avec un pas de temps de
                        <span class="scenario-pas fw-bold"></span>
                    </p>
                    <p>
                        Statut social: 
                        <span class="optimisme-social fw-bold"></span>
                    </p>
                    <p>
                        Statut écologique: 
                        <span class="optimisme-ecologique fw-bold"></span>
                    </p>
                </div>
            </div>
            <div class="d-flex w-100 justify-content-end mt-2">
                <button class="btn btn-danger mx-2" id="delete-scenario" style="display: none;">
                    Supprimer 
                    <span class="nom-supprimer"></span>
                </button>
                <button class="btn btn-primary" id="add-scenario">Nouveau scenario</button>
            </div>
        </div>
    </div>
    <div id="infrastructures" class="bg-light card">
        <div class="card-header">
            <h5 class="card-title">Groupe d'Infrastructures:</h5>
        </div>
        <div class="d-flex w-100 justify-content-space-between align-items-center my-3">
            <label style="white-space: nowrap;">Groupe actif: </label>
            <span class="mx-2"></span>
            <select name="groupe-actif" id="groupe-actif" class="form-select" onchange="changeInfra()">
            
            </select>
        </div>
        <button class="btn btn-primary w-100" style="display: none" disabled id="enregistrer-groupe" onclick="save_groupe()">
            Enregistrer changement
        </button>
        <div class="accordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="hydroHeading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#hydroCollapse" aria-expanded="false" aria-controls="hydroCollapse">
                        Barrage Hydro-Électrique
                    </button>
                </h2>
                <div id="hydroCollapse" class="accordion-collapse collapse" aria-labelledby="hydroHeading" data-bs-parent="#sidebar">
                    <div class="accordion-body">
                        <ul class="list-group">
                            
                        </ul>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="windHeading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#windCollapse" aria-expanded="false" aria-controls="windCollapse">
                        Parc Éolien
                    </button>
                </h2>
                <div id="windCollapse" class="accordion-collapse collapse" aria-labelledby="windHeading" data-bs-parent="#sidebar">
                    <div id="list-parc-eolien" class="accordion-body">
                        <div class="d-flex w-100 justify-content-center my-2">
                            <button class="btn btn-primary btn-sm select-all me-2" id="select_all_eolien">Tout sélectionner</button>
                            <button class="btn btn-primary btn-sm select-none" id="select_none_eolien">Tout désélectionner</button>
                        </div>
                        <ul class="list-group">

                        </ul>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="solarHeading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#solarCollapse" aria-expanded="false" aria-controls="solarCollapse">
                        Parc Solaire
                    </button>
                </h2>
                <div id="solarCollapse" class="accordion-collapse collapse" aria-labelledby="solarHeading" data-bs-parent="#sidebar">
                    <div id="list-parc-solaire" class="accordion-body">
                        <div class="d-flex w-100 justify-content-center my-2">
                            <button class="btn btn-primary btn-sm select-all me-2" id="select_all_solaire">Tout sélectionner</button>
                            <button class="btn btn-primary btn-sm select-none" id="select_none_solaire">Tout désélectionner</button>
                        </div>
                        <ul class="list-group">

                        </ul>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="thermalHeading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#thermalCollapse" aria-expanded="false" aria-controls="thermalCollapse">
                        Central Thermique
                    </button>
                </h2>
                <div id="thermalCollapse" class="accordion-collapse collapse" aria-labelledby="thermalHeading" data-bs-parent="#sidebar">
                    <div id="list-parc-thermique" class="accordion-body">
                        <div class="d-flex w-100 justify-content-center my-2">
                            <button class="btn btn-primary btn-sm select-all me-2" id="select_all_thermique">Tout sélectionner</button>
                            <button class="btn btn-primary btn-sm select-none" id="select_none_thermique">Tout désélectionner</button>
                        </div>
                        <ul class="list-group">

                        </ul>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="transmissionHeading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#transmissionCollapse" aria-expanded="false" aria-controls="transmissionCollapse">
                        Réseaux de Transmission
                    </button>
                </h2>
                <div id="transmissionCollapse" class="accordion-collapse collapse" aria-labelledby="transmissionHeading" data-bs-parent="#sidebar">
                    <div class="accordion-body">
                        <ul class="list-group">
                            
                        </ul>
                    </div>
                </div>
          </div>
        </div>
        <div class="w-100 d-flex justify-content-end mt-2">
            <button class="btn btn-primary" id="add-infra-liste">Nouveau Groupe</button>
        </div>
    </div>
    <div id="plots" class="d-flex flex-column">
        <ul class="nav nav-tabs" id="hero-header" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="map-tab" data-bs-toggle="tab" data-bs-target="#map" type="button" role="tab" aria-controls="map" aria-selected="true">Carte</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sankey-tab" data-bs-toggle="tab" data-bs-target="#sankey" type="button" role="tab" aria-controls="sankey" aria-selected="false">Demande/Production</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="production-tab" data-bs-toggle="tab" data-bs-target="#production" type="button" role="tab" aria-controls="production" aria-selected="false">Production</button>
            </li>
        </ul>
        <div class="tab-content flex-grow-1" id="myTabContent">
            <div class="tab-pane show active h-100" id="map" role="tabpanel" aria-labelledby="map-tab">
                <div id="map-box" style="width: 100%; height: 100%;">
                    <div id="icon-box" style="position: absolute; bottom: 10px; left: 10px; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); z-index: 1000; width: 200px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h5 style="margin: 0; font-weight: bold;">Légende</h5>
                            <button id="toggle-legend" style="background: none; border: none; font-size: 16px; cursor: pointer;">−</button>
                        </div>
                        <div id="legend-content">
                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                <img src="/static/icons/heolienne.png" style="width: 40px; height: 40px; margin-right: 8px;"> Parc Éolien
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                <img src="/static/icons/solaire.png" style="width: 45px; height: 45px; margin-right: 8px;"> Parc Solaire
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                <img src="/static/icons/thermique.png" style="width: 45px; height: 45px; margin-right: 8px;"> Centrale Thermique
                            </div>
                            <div style="display: flex; align-items: center;">
                                <img src="/static/icons/barrage.png" style="width: 55px; height: 55px; margin-right: 8px;"> Barrage Hydro-Électrique
                            </div>
                        </div>
                    </div>
                    <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            const toggleButton = document.getElementById("toggle-legend");
                            const legendContent = document.getElementById("legend-content");
                    
                            toggleButton.addEventListener("click", function () {
                                if (legendContent.style.display === "none") {
                                    // Afficher la légende
                                    legendContent.style.display = "block";
                                    toggleButton.textContent = "−"; // Changer le bouton pour "réduire"
                                } else {
                                    // Réduire la légende
                                    legendContent.style.display = "none";
                                    toggleButton.textContent = "+"; // Changer le bouton pour "afficher"
                                }
                            });
                        });
                    </script>
                </div>
            </div>
            <div class="tab-pane show h-100" id="production" role="tabpanel" aria-labelledby="production-tab">
                <div id="production-plot" style="height: 100%; width: 100%;"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="dataModal" tabindex="-1" aria-labelledby="dataModalLabel" aria-hidden="true">

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.33.1/plotly.min.js" integrity="sha512-V0j9LhrK9IMNdFYZqh+IqU4cjo7wdxyHNyH+L0td4HryBuZ7Oq6QxP2/CWr6TituX31+gv5PnolvERuTbz8UNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/moment/locale/fr.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js" integrity="sha512-BwHfrr4c9kmRkLw6iXFdzcdWV/PGkVgiIyIWLLlTSXzWQzxuSg4DiQUCpauz/EWjgk5TYQqX/kvn9pG1NpYfqg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="{{ url_for('static', path='graphiques.js') }}"></script>
<script src="{{ url_for('static', path='harmoniq.js') }}"></script>
{% endblock %}